
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Haushaltskalender</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; background: #f5f5f5; }
    header { position: fixed; top: 0; left: 0; right: 0; background: #4CAF50; color: white; padding: 10px; display: flex; justify-content: center; align-items: center; z-index: 300; }
    header h1 { margin: 0; font-size: 1.4em; text-align: center; flex: 1; }

    .top-controls { position: absolute; right: 10px; display: flex; align-items: center; gap: 10px; }
    #trash { font-size: 1.5em; cursor: pointer; position: relative; }
    #trash:hover::after { content: "Zum L√∂schen hierher ziehen"; position: absolute; top: 120%; left: -50%; background: #333; color: #fff; font-size: 0.8em; padding: 4px 6px; border-radius: 4px; white-space: nowrap; }

    #person-bar { margin-top: 50px; background: white; padding: 10px; display: flex; justify-content: center; gap: 15px; position: sticky; top: 50px; z-index: 200; }
    .person { padding: 8px 14px; border-radius: 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.2s; color: white; font-weight: bold; }
    .person.selected { border: 3px solid black; transform: scale(1.05); }

    .person[data-name="Lisa"] { background: green; }
    .person[data-name="Wasja"] { background: blue; }
    .person[data-name="Hanna"] { background: red; }
    .person[data-name="Ella"] { background: purple; }

    .content { display: flex; margin-top: 10px; }
    #task-sidebar { width: 240px; background: #2196F3; color: white; padding: 15px; border-radius: 12px; margin: 10px; height: calc(100vh - 150px); overflow-y: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; flex-direction: column; justify-content: space-between; }
    #task-sidebar h3 { margin-top: 0; }
    .task { background: #64B5F6; padding: 8px 10px; margin: 6px 0; border-radius: 10px; cursor: grab; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }

    #calendar-box { flex: 1; margin: 10px; background: white; border-radius: 16px; padding: 15px; box-shadow: 0 6px 16px rgba(0,0,0,0.2); }
    #calendar-header { text-align: center; font-size: 1.2em; font-weight: bold; margin-bottom: 10px; }
    #weekday-row { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-weight: bold; margin-bottom: 5px; }
    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); grid-gap: 10px; margin-top: 5px; }
    .day { border: 1px solid #ddd; min-height: 100px; padding: 6px; position: relative; background: #fafafa; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .day.today { background: #d9fdd3; } /* dezente Markierung f√ºr heute */
    .date-label { font-size: 0.8em; font-weight: bold; margin-bottom: 4px; }
    .assignment { margin: 3px 0; padding: 3px 6px; border-radius: 8px; font-size: 0.85em; position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.2); color: white; }

    /* Farben f√ºr Personen-Aufgaben */
    .assignment.Lisa { background: green; }
    .assignment.Wasja { background: blue; }
    .assignment.Hanna { background: red; }
    .assignment.Ella { background: purple; }

    #add-task-box { margin-top: 10px; }
    #newTaskInput { width: 100%; margin-bottom: 5px; }
  </style>
</head>
<body>
  <header>
    <h1>Haushaltskalender</h1>
    <div class="top-controls">
      <button onclick="prevMonth()">‚Äπ</button>
      <span id="monthYear"></span>
      <button onclick="nextMonth()">‚Ä∫</button>
      <div id="trash">üóëÔ∏è</div>
    </div>
  </header>

  <div id="person-bar">
    <div class="person" data-name="Lisa" onclick="selectPerson('Lisa')">Lisa</div>
    <div class="person" data-name="Wasja" onclick="selectPerson('Wasja')">Wasja</div>
    <div class="person" data-name="Hanna" onclick="selectPerson('Hanna')">Hanna</div>
    <div class="person" data-name="Ella" onclick="selectPerson('Ella')">Ella</div>
  </div>

  <div class="content">
    <div id="task-sidebar">
      <div>
        <h3>Ablage</h3>
        <div id="task-pool"></div>
      </div>
      <div id="add-task-box">
        <input type="text" id="newTaskInput" placeholder="Neue Aufgabe">
        <button onclick="addTask()">+ Aufgabe hinzuf√ºgen</button>
      </div>
    </div>
    <div id="calendar-box">
      <div id="calendar-header"></div>
      <div id="weekday-row">
        <div>Mo</div><div>Di</div><div>Mi</div><div>Do</div><div>Fr</div><div>Sa</div><div>So</div>
      </div>
      <div id="calendar"></div>
    </div>
  </div>

  <script>
    let currentMonth, currentYear;
    let selectedPerson = null;
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [
      "Geschirrsp√ºler ausr√§umen", "Staubsaugen Wohnzimmer", "Bad putzen",
      "M√ºll rausbringen", "W√§sche zusammenlegen", "Einkaufsliste schreiben",
      "Boden wischen K√ºche", "Staub wischen", "Fenster putzen",
      "Bettw√§sche wechseln", "K√ºhlschrank auswischen", "Familien-Einkauf",
      "Gartenarbeit", "B√ºcherregal aufr√§umen", "Familien-Aufr√§umrunde",
      "Spieleabend vorbereiten", "Zimmer gr√ºndlich saugen"
    ];
    let assignments = JSON.parse(localStorage.getItem('assignments')) || {};
    let savedState = JSON.parse(localStorage.getItem('calendarState')) || {};
    if (savedState.month !== undefined) { currentMonth = savedState.month; currentYear = savedState.year; }
    else { let now = new Date(); currentMonth = now.getMonth(); currentYear = now.getFullYear(); }

    function saveState() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
      localStorage.setItem('assignments', JSON.stringify(assignments));
      localStorage.setItem('calendarState', JSON.stringify({month: currentMonth, year: currentYear}));
    }

    function addTask() {
      let input = document.getElementById('newTaskInput');
      let value = input.value.trim();
      if (value) { tasks.push(value); input.value = ""; renderTasks(); saveState(); }
    }

    function renderTasks() {
      let pool = document.getElementById('task-pool');
      pool.innerHTML = "";
      tasks.forEach((task) => {
        let div = document.createElement('div');
        div.className = "task";
        div.draggable = true;
        div.textContent = task;
        div.addEventListener('dragstart', e => e.dataTransfer.setData("text/task", task));
        div.onclick = () => assignToSelected(task);
        pool.appendChild(div);
      });
    }

    function renderCalendar() {
      let monthYear = document.getElementById('monthYear');
      let header = document.getElementById('calendar-header');
      let cal = document.getElementById('calendar');
      let monthText = new Date(currentYear, currentMonth).toLocaleString('de-DE', {month: 'long', year: 'numeric'});
      monthYear.textContent = monthText;
      header.textContent = monthText;
      cal.innerHTML = "";
      let firstDay = new Date(currentYear, currentMonth, 1).getDay();
      if (firstDay === 0) firstDay = 7;
      let daysInMonth = new Date(currentYear, currentMonth+1, 0).getDate();
      let today = new Date();

      for (let i=1; i<firstDay; i++) { cal.appendChild(document.createElement('div')); }
      for (let d=1; d<=daysInMonth; d++) {
        let cell = document.createElement('div');
        cell.className = "day";
        if (d === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
          cell.classList.add("today");
        }
        cell.dataset.date = `${d}.${currentMonth+1}.${currentYear}`;
        let label = document.createElement('div');
        label.className = "date-label";
        label.textContent = `${d}.${currentMonth+1}.${currentYear}`;
        cell.appendChild(label);
        cell.ondragover = e => e.preventDefault();
        cell.ondrop = e => {
          let task = e.dataTransfer.getData("text/task");
          if (task) addAssignment(cell.dataset.date, task);
        };
        if (assignments[cell.dataset.date]) {
          assignments[cell.dataset.date].forEach(a => {
            let div = document.createElement('div');
            div.className = "assignment " + (a.person || "");
            div.textContent = a.task;
            div.draggable = true;
            div.addEventListener('dragstart', e => e.dataTransfer.setData("text/assignment", JSON.stringify({date: cell.dataset.date, task: a.task, person: a.person})));
            cell.appendChild(div);
          });
        }
        cal.appendChild(cell);
      }
    }

    function addAssignment(date, task) {
      if (!task) return;
      if (!assignments[date]) assignments[date] = [];
      assignments[date].push({task: task, person: selectedPerson});
      selectedPerson = null;
      document.querySelectorAll('.person').forEach(p => p.classList.remove("selected"));
      saveState();
      renderCalendar();
    }

    function selectPerson(name) {
      selectedPerson = name;
      document.querySelectorAll('.person').forEach(p => p.classList.remove("selected"));
      document.querySelector('.person[data-name="'+name+'"]').classList.add("selected");
    }

    function prevMonth() { currentMonth--; if (currentMonth<0) { currentMonth=11; currentYear--; } saveState(); renderCalendar(); }
    function nextMonth() { currentMonth++; if (currentMonth>11) { currentMonth=0; currentYear++; } saveState(); renderCalendar(); }

    // Trash handling
    let trash = document.getElementById('trash');
    trash.ondragover = e => e.preventDefault();
    trash.ondrop = e => {
      let task = e.dataTransfer.getData("text/task");
      if (task) {
        tasks = tasks.filter(t => t !== task);
        for (let d in assignments) {
          assignments[d] = assignments[d].filter(a => a.task !== task);
        }
      }
      let as = e.dataTransfer.getData("text/assignment");
      if (as) {
        let a = JSON.parse(as);
        assignments[a.date] = assignments[a.date].filter(x => !(x.task===a.task && x.person===a.person));
      }
      saveState();
      renderTasks();
      renderCalendar();
    };

    renderTasks();
    renderCalendar();
  </script>
</body>
</html>
